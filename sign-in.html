<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sign In - Chartered Investment Company</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(120deg,#5E1010,#FFECCC);
  color:#5E1010;
}

.container{
  max-width:500px;
  margin:60px auto;
  background:#fff;
  padding:40px 30px;
  border-radius:12px;
  box-shadow:0 8px 20px rgba(0,0,0,.15);
}

.form-header{
  display:flex;
  justify-content:space-between;
  margin-bottom:25px;
}
.form-header button{
  background:none;
  border:none;
  font-weight:bold;
  font-size:16px;
  cursor:pointer;
  color:#5E1010;
}
.form-header button.active{
  border-bottom:3px solid #5E1010;
  padding-bottom:4px;
}

form{ display:flex; flex-direction:column; }

input{
  padding:12px;
  border:1px solid #ccc;
  border-radius:6px;
  margin-bottom:14px;
}

label{ font-weight:bold; margin-bottom:5px; }

.submit-btn, .next-btn, .back-btn{
  background:#5E1010;
  color:#FFECCC;
  padding:12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.submit-btn:hover, .next-btn:hover, .back-btn:hover{ opacity:.9; }

.form-step{ display:none; }
.form-step.active{ display:flex; flex-direction:column; }

#loginForm{ display:none; }
#loginForm.active{ display:flex; flex-direction:column; }

#popup{
  position:fixed; top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,.6);
  display:none;
  justify-content:center;
  align-items:center;
}
.popup-content{
  background:#fff;
  padding:25px;
  border-radius:12px;
  text-align:center;
}

/* ===========================
   LOADING OVERLAY + BLUR
   =========================== */
#loaderOverlay{
  position:fixed;
  inset:0;
  background:rgba(10,10,10,.45);
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  z-index:9999;
}

#loaderOverlay p{
  color:#fff;
  margin-top:10px;
  letter-spacing:.4px;
}

.loader{
  width:48px;
  height:48px;
  border:4px solid rgba(255,255,255,.3);
  border-top-color:#00ffa6;
  border-radius:50%;
  animation:spin .8s linear infinite;
}

@keyframes spin{ to{ transform:rotate(360deg);} }

/* blur page when loading */
body.loading .container{
  filter:blur(4px);
  pointer-events:none;
  user-select:none;
}
</style>
</head>

<body>

<!-- LOADER -->
<div id="loaderOverlay">
  <div class="loader"></div>
  <p>Processing...</p>
</div>

<div class="container">

  <div class="form-header">
    <button id="registerBtn" class="active">Register</button>
    <button id="loginBtn">Login</button>
  </div>

  <!-- REGISTER -->
  <form id="registerForm">

    <!-- STEP 1 -->
    <div class="form-step active" id="step1">
      <label>First Name</label>
      <input id="firstName" required>

      <label>Last Name</label>
      <input id="lastName" required>

      <label>Email</label>
      <input type="email" id="email" required>

      <label>Phone</label>
      <input type="tel" id="phone" required>

      <label>Date of Birth</label>
      <input type="date" id="dob" required>

      <button type="button" class="next-btn" onclick="nextStep(1)">Continue</button>
    </div>

    <!-- STEP 2 -->
    <div class="form-step" id="step2">
      <label>Street</label>
      <input id="street">

      <label>City</label>
      <input id="city">

      <label>State</label>
      <input id="state">

      <label>ZIP</label>
      <input id="zip">

      <label>Password</label>
      <input type="password" id="password" required>

      <label>Confirm Password</label>
      <input type="password" id="confirmPassword" required>

      <div style="display:flex; justify-content:space-between;">
        <button type="button" class="submit-btn" onclick="submitRegistration()">Register</button>
        <button type="button" class="back-btn" onclick="prevStep(2)">Back</button>
      </div>
    </div>

  </form>

  <!-- LOGIN -->
  <form id="loginForm">
    <label>Email</label>
    <input type="email" id="loginEmail" required>

    <label>Password</label>
    <input type="password" id="loginPassword" required>

    <button type="button" class="submit-btn" onclick="submitLogin()">Login</button>
  </form>

</div>

<!-- POPUP -->
<div id="popup">
  <div class="popup-content">
    <h3>Registration Successful!</h3>
    <p>Your identity is being verified.</p>
    <button onclick="closePopup()">Close</button>
  </div>
</div>

<script>
const backend = "https://investment-9ub4.onrender.com/api";

const registerBtn = document.getElementById("registerBtn");
const loginBtn = document.getElementById("loginBtn");
const registerForm = document.getElementById("registerForm");
const loginForm   = document.getElementById("loginForm");
const popup       = document.getElementById("popup");

function showLoader(){
  document.body.classList.add("loading");
  document.getElementById("loaderOverlay").style.display = "flex";
}
function hideLoader(){
  document.body.classList.remove("loading");
  document.getElementById("loaderOverlay").style.display = "none";
}

// toggle
registerBtn.onclick = () => {
  registerForm.style.display = "flex";
  loginForm.classList.remove("active");
  registerBtn.classList.add("active");
  loginBtn.classList.remove("active");
};
loginBtn.onclick = () => {
  registerForm.style.display = "none";
  loginForm.classList.add("active");
  loginBtn.classList.add("active");
  registerBtn.classList.remove("active");
};

// steps
function nextStep(c){
  document.getElementById(`step${c}`).classList.remove("active");
  document.getElementById(`step${c+1}`).classList.add("active");
}
function prevStep(c){
  document.getElementById(`step${c}`).classList.remove("active");
  document.getElementById(`step${c-1}`).classList.add("active");
}

// register
async function submitRegistration(){
  if(password.value !== confirmPassword.value){
    return alert("Passwords do not match");
  }

  const body = {
    firstName:firstName.value,
    lastName:lastName.value,
    email:email.value,
    phone:phone.value,
    dob:dob.value,
    street:street.value,
    city:city.value,
    state:state.value,
    zip:zip.value,
    password:password.value
  };

  showLoader();

  try{
    const res = await fetch(`${backend}/register`, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify(body)
    });

    const data = await res.json();

    if(res.ok){
      popup.style.display="flex";
      registerForm.reset();
    } else {
      alert(data.message || "Registration failed");
    }
  } catch(e){
    alert("Network error");
  } finally{
    hideLoader();
  }
}

// login
async function submitLogin(){
  showLoader();
  try {
    const res = await fetch(`${backend}/login`, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        email:loginEmail.value,
        password:loginPassword.value
      })
    });

    const data = await res.json();

    if(res.ok){
      localStorage.setItem("token", data.token);
      localStorage.setItem("userData", JSON.stringify(data.user));

      if(data.user.role === "admin"){
        location.href = "admin-dashboard.html";
      } else {
        location.href = "dashboard.html";
      }
    } else {
      alert(data.message || "Invalid login");
    }
  } catch(e){
    alert("Network error");
  } finally{
    hideLoader();
  }
}

function closePopup(){ popup.style.display="none"; }
</script>
</body>
        </html>
